import { expect, test } from "vitest";
import { isoDateToEpochDays } from "../abstractOperations.ts";
import type { CalendarDateRecord } from "../calendars.ts";
import { calendarIntegersToEpochDays, daysInMonth, epochDaysToDate } from "./indian.ts";

function epochDay(year: number, month: number, day: number) {
	return isoDateToEpochDays(year, month - 1, day);
}

function ymd(date: CalendarDateRecord) {
	return [date.$year, date.$month, date.$day];
}

test("calendarIntegersToEpochDays", () => {
	expect(calendarIntegersToEpochDays(1892, 1, 1)).toEqual(epochDay(1970, 3, 22));
	expect(calendarIntegersToEpochDays(1892, 1, 30)).toEqual(epochDay(1970, 4, 20));
	expect(calendarIntegersToEpochDays(1892, 2, 1)).toEqual(epochDay(1970, 4, 21));
	expect(calendarIntegersToEpochDays(1892, 2, 31)).toEqual(epochDay(1970, 5, 21));
	expect(calendarIntegersToEpochDays(1892, 3, 1)).toEqual(epochDay(1970, 5, 22));
	expect(calendarIntegersToEpochDays(1892, 3, 31)).toEqual(epochDay(1970, 6, 21));
	expect(calendarIntegersToEpochDays(1892, 4, 1)).toEqual(epochDay(1970, 6, 22));
	expect(calendarIntegersToEpochDays(1892, 4, 31)).toEqual(epochDay(1970, 7, 22));
	expect(calendarIntegersToEpochDays(1892, 5, 1)).toEqual(epochDay(1970, 7, 23));
	expect(calendarIntegersToEpochDays(1892, 5, 31)).toEqual(epochDay(1970, 8, 22));
	expect(calendarIntegersToEpochDays(1892, 6, 1)).toEqual(epochDay(1970, 8, 23));
	expect(calendarIntegersToEpochDays(1892, 6, 31)).toEqual(epochDay(1970, 9, 22));
	expect(calendarIntegersToEpochDays(1892, 7, 1)).toEqual(epochDay(1970, 9, 23));
	expect(calendarIntegersToEpochDays(1892, 7, 30)).toEqual(epochDay(1970, 10, 22));
	expect(calendarIntegersToEpochDays(1892, 8, 1)).toEqual(epochDay(1970, 10, 23));
	expect(calendarIntegersToEpochDays(1892, 8, 30)).toEqual(epochDay(1970, 11, 21));
	expect(calendarIntegersToEpochDays(1892, 9, 1)).toEqual(epochDay(1970, 11, 22));
	expect(calendarIntegersToEpochDays(1892, 9, 30)).toEqual(epochDay(1970, 12, 21));
	expect(calendarIntegersToEpochDays(1892, 10, 1)).toEqual(epochDay(1970, 12, 22));
	expect(calendarIntegersToEpochDays(1892, 10, 30)).toEqual(epochDay(1971, 1, 20));
	expect(calendarIntegersToEpochDays(1892, 11, 1)).toEqual(epochDay(1971, 1, 21));
	expect(calendarIntegersToEpochDays(1892, 11, 30)).toEqual(epochDay(1971, 2, 19));
	expect(calendarIntegersToEpochDays(1892, 12, 1)).toEqual(epochDay(1971, 2, 20));
	expect(calendarIntegersToEpochDays(1892, 12, 30)).toEqual(epochDay(1971, 3, 21));
	expect(calendarIntegersToEpochDays(1894, 1, 1)).toEqual(epochDay(1972, 3, 21));
	expect(calendarIntegersToEpochDays(1894, 1, 31)).toEqual(epochDay(1972, 4, 20));
	expect(calendarIntegersToEpochDays(1894, 2, 1)).toEqual(epochDay(1972, 4, 21));
	expect(calendarIntegersToEpochDays(1894, 2, 31)).toEqual(epochDay(1972, 5, 21));
	expect(calendarIntegersToEpochDays(1894, 3, 1)).toEqual(epochDay(1972, 5, 22));
	expect(calendarIntegersToEpochDays(1894, 3, 31)).toEqual(epochDay(1972, 6, 21));
	expect(calendarIntegersToEpochDays(1894, 4, 1)).toEqual(epochDay(1972, 6, 22));
	expect(calendarIntegersToEpochDays(1894, 4, 31)).toEqual(epochDay(1972, 7, 22));
	expect(calendarIntegersToEpochDays(1894, 5, 1)).toEqual(epochDay(1972, 7, 23));
	expect(calendarIntegersToEpochDays(1894, 5, 31)).toEqual(epochDay(1972, 8, 22));
	expect(calendarIntegersToEpochDays(1894, 6, 1)).toEqual(epochDay(1972, 8, 23));
	expect(calendarIntegersToEpochDays(1894, 6, 31)).toEqual(epochDay(1972, 9, 22));
	expect(calendarIntegersToEpochDays(1894, 7, 1)).toEqual(epochDay(1972, 9, 23));
	expect(calendarIntegersToEpochDays(1894, 7, 30)).toEqual(epochDay(1972, 10, 22));
	expect(calendarIntegersToEpochDays(1894, 8, 1)).toEqual(epochDay(1972, 10, 23));
	expect(calendarIntegersToEpochDays(1894, 8, 30)).toEqual(epochDay(1972, 11, 21));
	expect(calendarIntegersToEpochDays(1894, 9, 1)).toEqual(epochDay(1972, 11, 22));
	expect(calendarIntegersToEpochDays(1894, 9, 30)).toEqual(epochDay(1972, 12, 21));
	expect(calendarIntegersToEpochDays(1894, 10, 1)).toEqual(epochDay(1972, 12, 22));
	expect(calendarIntegersToEpochDays(1894, 10, 30)).toEqual(epochDay(1973, 1, 20));
	expect(calendarIntegersToEpochDays(1894, 11, 1)).toEqual(epochDay(1973, 1, 21));
	expect(calendarIntegersToEpochDays(1894, 11, 30)).toEqual(epochDay(1973, 2, 19));
	expect(calendarIntegersToEpochDays(1894, 12, 1)).toEqual(epochDay(1973, 2, 20));
	expect(calendarIntegersToEpochDays(1894, 12, 30)).toEqual(epochDay(1973, 3, 21));
});

test("epochDaysToDate - year, month, day", () => {
	expect(ymd(epochDaysToDate(epochDay(1970, 3, 22)))).toEqual([1892, 1, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 4, 20)))).toEqual([1892, 1, 30]);
	expect(ymd(epochDaysToDate(epochDay(1970, 4, 21)))).toEqual([1892, 2, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 5, 21)))).toEqual([1892, 2, 31]);
	expect(ymd(epochDaysToDate(epochDay(1970, 5, 22)))).toEqual([1892, 3, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 6, 21)))).toEqual([1892, 3, 31]);
	expect(ymd(epochDaysToDate(epochDay(1970, 6, 22)))).toEqual([1892, 4, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 7, 22)))).toEqual([1892, 4, 31]);
	expect(ymd(epochDaysToDate(epochDay(1970, 7, 23)))).toEqual([1892, 5, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 8, 22)))).toEqual([1892, 5, 31]);
	expect(ymd(epochDaysToDate(epochDay(1970, 8, 23)))).toEqual([1892, 6, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 9, 22)))).toEqual([1892, 6, 31]);
	expect(ymd(epochDaysToDate(epochDay(1970, 9, 23)))).toEqual([1892, 7, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 10, 22)))).toEqual([1892, 7, 30]);
	expect(ymd(epochDaysToDate(epochDay(1970, 10, 23)))).toEqual([1892, 8, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 11, 21)))).toEqual([1892, 8, 30]);
	expect(ymd(epochDaysToDate(epochDay(1970, 11, 22)))).toEqual([1892, 9, 1]);
	expect(ymd(epochDaysToDate(epochDay(1970, 12, 21)))).toEqual([1892, 9, 30]);
	expect(ymd(epochDaysToDate(epochDay(1970, 12, 22)))).toEqual([1892, 10, 1]);
	expect(ymd(epochDaysToDate(epochDay(1971, 1, 20)))).toEqual([1892, 10, 30]);
	expect(ymd(epochDaysToDate(epochDay(1971, 1, 21)))).toEqual([1892, 11, 1]);
	expect(ymd(epochDaysToDate(epochDay(1971, 2, 19)))).toEqual([1892, 11, 30]);
	expect(ymd(epochDaysToDate(epochDay(1971, 2, 20)))).toEqual([1892, 12, 1]);
	expect(ymd(epochDaysToDate(epochDay(1971, 3, 21)))).toEqual([1892, 12, 30]);
	expect(ymd(epochDaysToDate(epochDay(1972, 3, 21)))).toEqual([1894, 1, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 4, 20)))).toEqual([1894, 1, 31]);
	expect(ymd(epochDaysToDate(epochDay(1972, 4, 21)))).toEqual([1894, 2, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 5, 21)))).toEqual([1894, 2, 31]);
	expect(ymd(epochDaysToDate(epochDay(1972, 5, 22)))).toEqual([1894, 3, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 6, 21)))).toEqual([1894, 3, 31]);
	expect(ymd(epochDaysToDate(epochDay(1972, 6, 22)))).toEqual([1894, 4, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 7, 22)))).toEqual([1894, 4, 31]);
	expect(ymd(epochDaysToDate(epochDay(1972, 7, 23)))).toEqual([1894, 5, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 8, 22)))).toEqual([1894, 5, 31]);
	expect(ymd(epochDaysToDate(epochDay(1972, 8, 23)))).toEqual([1894, 6, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 9, 22)))).toEqual([1894, 6, 31]);
	expect(ymd(epochDaysToDate(epochDay(1972, 9, 23)))).toEqual([1894, 7, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 10, 22)))).toEqual([1894, 7, 30]);
	expect(ymd(epochDaysToDate(epochDay(1972, 10, 23)))).toEqual([1894, 8, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 11, 21)))).toEqual([1894, 8, 30]);
	expect(ymd(epochDaysToDate(epochDay(1972, 11, 22)))).toEqual([1894, 9, 1]);
	expect(ymd(epochDaysToDate(epochDay(1972, 12, 21)))).toEqual([1894, 9, 30]);
	expect(ymd(epochDaysToDate(epochDay(1972, 12, 22)))).toEqual([1894, 10, 1]);
	expect(ymd(epochDaysToDate(epochDay(1973, 1, 20)))).toEqual([1894, 10, 30]);
	expect(ymd(epochDaysToDate(epochDay(1973, 1, 21)))).toEqual([1894, 11, 1]);
	expect(ymd(epochDaysToDate(epochDay(1973, 2, 19)))).toEqual([1894, 11, 30]);
	expect(ymd(epochDaysToDate(epochDay(1973, 2, 20)))).toEqual([1894, 12, 1]);
	expect(ymd(epochDaysToDate(epochDay(1973, 3, 21)))).toEqual([1894, 12, 30]);
});

test("daysInMonth", () => {
	expect(daysInMonth(1892, 1)).toEqual(30);
	expect(daysInMonth(1892, 2)).toEqual(31);
	expect(daysInMonth(1892, 3)).toEqual(31);
	expect(daysInMonth(1892, 4)).toEqual(31);
	expect(daysInMonth(1892, 5)).toEqual(31);
	expect(daysInMonth(1892, 6)).toEqual(31);
	expect(daysInMonth(1892, 7)).toEqual(30);
	expect(daysInMonth(1892, 8)).toEqual(30);
	expect(daysInMonth(1892, 9)).toEqual(30);
	expect(daysInMonth(1892, 10)).toEqual(30);
	expect(daysInMonth(1892, 11)).toEqual(30);
	expect(daysInMonth(1892, 12)).toEqual(30);
	expect(daysInMonth(1894, 1)).toEqual(31);
	expect(daysInMonth(1894, 2)).toEqual(31);
	expect(daysInMonth(1894, 3)).toEqual(31);
	expect(daysInMonth(1894, 4)).toEqual(31);
	expect(daysInMonth(1894, 5)).toEqual(31);
	expect(daysInMonth(1894, 6)).toEqual(31);
	expect(daysInMonth(1894, 7)).toEqual(30);
	expect(daysInMonth(1894, 8)).toEqual(30);
	expect(daysInMonth(1894, 9)).toEqual(30);
	expect(daysInMonth(1894, 10)).toEqual(30);
	expect(daysInMonth(1894, 11)).toEqual(30);
	expect(daysInMonth(1894, 12)).toEqual(30);
});
